<script type="text/javascript">
  const URL = "https://teachablemachine.withgoogle.com/models/BIbJVnndE/"; // Replace with your model URL
  let model, webcam, labelContainer, maxPredictions;
  let lastFrameTime = 0;
  const frameInterval = 100; // ~10 FPS
  let isRunning = false;

  async function init(facingMode) {
    if (isRunning) {
      console.log("Already running, please stop first.");
      return;
    }
    isRunning = true;

    // Initialize labelContainer and validate
    labelContainer = document.getElementById("label-container");
    if (!labelContainer) {
      console.error("Error: Element with id 'label-container' not found in the DOM.");
      alert("Error: 'label-container' element not found. Please check your HTML.");
      isRunning = false;
      return;
    }
    labelContainer.innerText = "Initializing...";
    console.log("Initializing with facingMode:", facingMode);

    // Check for getUserMedia support
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      labelContainer.innerText = "Error: Webcam not supported by this browser.";
      console.error("Webcam not supported by this browser.");
      isRunning = false;
      return;
    }

    // Load the model
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";
    try {
      labelContainer.innerText = "Loading model...";
      console.log("Loading model from:", modelURL);
      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();
      console.log("Model loaded successfully, classes:", maxPredictions);
    } catch (e) {
      console.error("Model loading failed:", e);
      labelContainer.innerText = `Error: Failed to load model. Ensure the URL (${URL}) is correct and accessible.`;
      isRunning = false;
      return;
    }

    // Initialize webcam
    try {
      labelContainer.innerText = "Setting up webcam...";
      const scale = window.devicePixelRatio || 1;
      webcam = new tmImage.Webcam(224 * scale, 224 * scale, false);
      await webcam.setup({ facingMode: facingMode });
      await webcam.play();
      if (!webcam.canvas) {
        throw new Error("Webcam canvas not initialized");
      }
      console.log("Webcam initialized, width:", webcam.canvas.width, "facingMode:", facingMode);
      webcam.canvas.style.width = "224px";
      webcam.canvas.style.height = "224px";
      const webcamContainer = document.getElementById("webcam-container");
      if (!webcamContainer) {
        throw new Error("Webcam container element not found");
